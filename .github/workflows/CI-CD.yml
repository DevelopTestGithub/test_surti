name: Build and Release apk
on:
  push:
    tags:
      - '*'
jobs:
  build:
    strategy:
      matrix:
        body:
          - file://build/app/outputs/apk/profile/*.apk
          - Test of action completed successfully!
    name: Build APK
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - uses: subosito/flutter-action@v1
        with:
          flutter-version: '1.9.1+hotfix.6'
          channel: stable
      - run: flutter pub get
      - run: flutter build apk --profile --split-per-abi
      - name: Push APK to Releases
        uses: ncipollo/release-action@v1
        with:
          artifacts: "build/app/outputs/apk/profile/*.apk"
          token: ${{ secrets.TOKEN }}
      - name: CHECK EMAIL
        uses: actions/checkout@v1
      - name: Send mail
        uses: dawidd6/action-send-mail@v1.3.0
        with:
          server_address: ${{secrets.ADDRESS_GMAIL}}
          server_port: 465
          username: ${{secrets.MAIL_USER}}
          password: ${{secrets.MAIL_PASSWORD}}
          subject: ${{github.repository}}
          body: ${{matrix.body}}
          to: jipina_est@utmachala.edu.ec
          from: JOSIAS PINA
          # Optional content type:
          content_type: text/html